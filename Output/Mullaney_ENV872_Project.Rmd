---
output: 
  pdf_document:
    keep_tex: yes
    fig_caption: yes
    number_sections: yes
geometry: margin=2.54cm
title: "Analysis of factors impacting fish and coral abundance across management zones on the inshore coral reefs of the Great Barrier Reef Marine Park"
subtitle: "https://github.com/cmullane94/ENV_872_Project"
author: "Claire Mullaney"
fontsize: 12pt
mainfont: Times New Roman

---

\newpage
\tableofcontents 
\newpage
\listoftables 
\newpage
\listoffigures 
\newpage

```{r setup, include=FALSE, knitr::opts_knit$set(root.dir = "/Users/clairemullaney/Desktop/ENV 872/Environmental_Data_Analytics_2020/Project/ENV_872_Project")}
# Set your working directory
getwd()

# Load your packages
library(tidyverse)
library(GGally)
library(nlme)
library(piecewiseSEM)
library(MASS)
library(agricolae)

# Set your ggplot theme
deftheme <- theme_classic(base_size = 14) + 
  theme(axis.text = element_text(color = "black"),
        legend.position = "right") 
theme_set(deftheme)

# Load your datasets
GBR_Sites_Processed_2004 <- read.csv("./Data/Processed/data.gov.au_fish_benthos_GBR_sites_2004_processed.csv")
GBR_Sites_Processed_1999 <- read.csv("./Data/Processed/data.gov.au_fish_benthos_GBR_sites_1999_processed.csv")
GBR_Sites_Processed_2004_fish_lme <- read.csv("./Data/Processed/data.gov.au_fish_lme_2004_processed.csv")

GBR_Sites_Processed_2004$Year <- as.factor(GBR_Sites_Processed_2004$Year)
GBR_Sites_Processed_1999$Year <- as.factor(GBR_Sites_Processed_1999$Year)
GBR_Sites_Processed_2004_fish_lme$Year <- as.factor(GBR_Sites_Processed_2004_fish_lme$Year)
```

# Rationale and Research Questions

• Contains clear context for research topic
• Contains rationale for dataset of choice
• Contains one or more questions of an appropriate scope
for the project

As stressors such as ___ increasingly affect coral reefs worldwide, multiple-use zoning is becoming 

This dataset was selected because it is one of the few projects established with the goal of specifically assessing the ecological effects of multiple-use zoning on the inshore coral reefs of the Great Barrier Reef Marine Park (GBRMP). Additionally, it is the only long-term monitoring project with a dataset that was established prior to the implementation of a new zoning management plan in 2004.

This project sought to answer the following questions about the inshore coral reefs of the GBRMP:

1. What variables affect live hard coral cover?
2. What variables affect fish density?
3. Do no-take zones established in 1987, no-take zones established in 2004, and fished zones have different mean amounts of live hard coral cover, fish density, and fish species richness?

\newpage

# Dataset Information

• Describes source and content of data
• Details the wrangling process from raw to processed data
• Contains a table summarizing the dataset structure

\newpage

# Exploratory Analysis 

• Flow between text and visualizations is cohesive
• Relevant exploratory information is visualized

\newpage

# Analysis

• Flow between text and visualizations is cohesive
• Visualizations and statistical tests pertain directly to
specific questions
• Statistical results are reported in plain language with
relevant statistical output in parentheses
• Findings are reported clearly in relation to research
questions

## Question 1: What variables affect live hard coral cover on the inshore coral reefs of the GBRMP?


``` {r Coral % Cover Model, include = FALSE}
LHC_mixed_final <- lme(data = GBR_Sites_Processed_2004, LHC_mean ~ Year + Grazers_mean + 
                         Corallivores_mean + MAC_mean, random = ~1|Site, method = "ML")
```

```{r Coral % Cover Plot (Corallivores), echo = FALSE, fig.align = left, fig.cap = "Modeled relationship between the mean number of corallivore fish species, the mean percent cover of living hard coral, and the mean percent cover of fleshy macroalgae for 2004, 2006-2009, and 2011-2014. Regression lines are plotted using using the mean number of grazer species and the mean percent cover of fleshy macroalgae for the year corresponding to the facet."}

eq_2004_coral <- with(GBR_Sites_Processed_2004, function(x){fixef(LHC_mixed_final)[11] * x + 
    fixef(LHC_mixed_final)[1] + 
    fixef(LHC_mixed_final)[10] * mean(Grazers_mean[Year == 2004]) +
    fixef(LHC_mixed_final)[12] * mean(MAC_mean[Year == 2004])})
eq_2006_coral <- with(GBR_Sites_Processed_2004, function(x){fixef(LHC_mixed_final)[11] * x + 
    fixef(LHC_mixed_final)[1] +
    fixef(LHC_mixed_final)[2] + 
    fixef(LHC_mixed_final)[10] * mean(Grazers_mean[Year == 2006]) +
    fixef(LHC_mixed_final)[12] * mean(MAC_mean[Year == 2006])})
eq_2007_coral <- with(GBR_Sites_Processed_2004, function(x){fixef(LHC_mixed_final)[11] * x + 
    fixef(LHC_mixed_final)[1] +
    fixef(LHC_mixed_final)[3] + 
    fixef(LHC_mixed_final)[10] * mean(Grazers_mean[Year == 2007]) +
    fixef(LHC_mixed_final)[12] * mean(MAC_mean[Year == 2007])})
eq_2008_coral <- with(GBR_Sites_Processed_2004, function(x){fixef(LHC_mixed_final)[11] * x + 
    fixef(LHC_mixed_final)[1] +
    fixef(LHC_mixed_final)[4] + 
    fixef(LHC_mixed_final)[10] * mean(Grazers_mean[Year == 2008]) +
    fixef(LHC_mixed_final)[12] * mean(MAC_mean[Year == 2008])})
eq_2009_coral <- with(GBR_Sites_Processed_2004, function(x){fixef(LHC_mixed_final)[11] * x + 
    fixef(LHC_mixed_final)[1] +
    fixef(LHC_mixed_final)[5] + 
    fixef(LHC_mixed_final)[10] * mean(Grazers_mean[Year == 2009]) +
    fixef(LHC_mixed_final)[12] * mean(MAC_mean[Year == 2009])})
eq_2011_coral <- with(GBR_Sites_Processed_2004, function(x){fixef(LHC_mixed_final)[11] * x + 
    fixef(LHC_mixed_final)[1] +
    fixef(LHC_mixed_final)[6] + 
    fixef(LHC_mixed_final)[10] * mean(Grazers_mean[Year == 2011]) +
    fixef(LHC_mixed_final)[12] * mean(MAC_mean[Year == 2011])})
eq_2012_coral <- with(GBR_Sites_Processed_2004, function(x){fixef(LHC_mixed_final)[11] * x + 
    fixef(LHC_mixed_final)[1] +
    fixef(LHC_mixed_final)[7] + 
    fixef(LHC_mixed_final)[10] * mean(Grazers_mean[Year == 2012]) +
    fixef(LHC_mixed_final)[12] * mean(MAC_mean[Year == 2012])})
eq_2013_coral <- with(GBR_Sites_Processed_2004, function(x){fixef(LHC_mixed_final)[11] * x + 
    fixef(LHC_mixed_final)[1] +
    fixef(LHC_mixed_final)[8] + 
    fixef(LHC_mixed_final)[10] * mean(Grazers_mean[Year == 2013]) +
    fixef(LHC_mixed_final)[12] * mean(MAC_mean[Year == 2013])})
eq_2014_coral <- with(GBR_Sites_Processed_2004, function(x){fixef(LHC_mixed_final)[11] * x + 
    fixef(LHC_mixed_final)[1] +
    fixef(LHC_mixed_final)[9] + 
    fixef(LHC_mixed_final)[10] * mean(Grazers_mean[Year == 2014]) +
    fixef(LHC_mixed_final)[12] * mean(MAC_mean[Year == 2014])})

#Plot with corallivores on the x-axis
LHC_corallivores_plot <- ggplot(GBR_Sites_Processed_2004) + 
  aes(y = LHC_mean, color = MAC_mean, x = Corallivores_mean) +
  geom_point() +
  ylim(0, 100) +
  scale_color_viridis_c(option = "plasma") +
  theme(legend.position = "top") +
  labs(y = "Mean live hard coral % cover", 
       x = "Mean number of corallivore fish species",
       color = "Mean fleshy macroalgae % cover") +
  facet_wrap(vars(Year)) +
  stat_function(fun = eq_2004_coral, 
                data = subset(GBR_Sites_Processed_2004, 
                              Year == 2004)) + 
  stat_function(fun = eq_2006_coral, 
                data = subset(GBR_Sites_Processed_2004, 
                              Year == 2006)) +
  stat_function(fun = eq_2007_coral, 
                data = subset(GBR_Sites_Processed_2004, 
                              Year == 2007)) +
  stat_function(fun = eq_2008_coral, 
                data = subset(GBR_Sites_Processed_2004, 
                              Year == 2008)) +
  stat_function(fun = eq_2009_coral, 
                data = subset(GBR_Sites_Processed_2004, 
                              Year == 2009)) +
  stat_function(fun = eq_2011_coral, 
                data = subset(GBR_Sites_Processed_2004, 
                              Year == 2011)) +
  stat_function(fun = eq_2012_coral, 
                data = subset(GBR_Sites_Processed_2004, 
                              Year == 2012)) +
  stat_function(fun = eq_2013_coral, 
                data = subset(GBR_Sites_Processed_2004, 
                              Year == 2013)) +
  stat_function(fun = eq_2014_coral, 
                data = subset(GBR_Sites_Processed_2004, 
                              Year == 2014)) 

print(LHC_corallivores_plot)

```

```{r Coral % Cover Plot (Corallivores), echo = FALSE, fig.align = left, fig.cap = "Modeled relationship between the mean number of grazer fish species, the mean percent cover of living hard coral, and the mean percent cover of fleshy macroalgae for 2004, 2006-2009, and 2011-2014. Regression lines are plotted using using the mean number of corallivore species and the mean percent cover of fleshy macroalgae for the year corresponding to the facet."}

eq_2004_grazer <- with(GBR_Sites_Processed_2004, function(x){fixef(LHC_mixed_final)[10] * x + 
    fixef(LHC_mixed_final)[1] + 
    fixef(LHC_mixed_final)[11] * mean(Corallivores_mean[Year == 2004]) +
    fixef(LHC_mixed_final)[12] * mean(MAC_mean[Year == 2004])})
eq_2006_grazer <- with(GBR_Sites_Processed_2004, function(x){fixef(LHC_mixed_final)[10] * x + 
    fixef(LHC_mixed_final)[1] +
    fixef(LHC_mixed_final)[2] + 
    fixef(LHC_mixed_final)[11] * mean(Corallivores_mean[Year == 2006]) +
    fixef(LHC_mixed_final)[12] * mean(MAC_mean[Year == 2006])})
eq_2007_grazer <- with(GBR_Sites_Processed_2004, function(x){fixef(LHC_mixed_final)[10] * x + 
    fixef(LHC_mixed_final)[1] +
    fixef(LHC_mixed_final)[3] + 
    fixef(LHC_mixed_final)[11] * mean(Corallivores_mean[Year == 2007]) +
    fixef(LHC_mixed_final)[12] * mean(MAC_mean[Year == 2007])})
eq_2008_grazer <- with(GBR_Sites_Processed_2004, function(x){fixef(LHC_mixed_final)[10] * x + 
    fixef(LHC_mixed_final)[1] +
    fixef(LHC_mixed_final)[4] + 
    fixef(LHC_mixed_final)[11] * mean(Corallivores_mean[Year == 2008]) +
    fixef(LHC_mixed_final)[12] * mean(MAC_mean[Year == 2008])})
eq_2009_grazer <- with(GBR_Sites_Processed_2004, function(x){fixef(LHC_mixed_final)[10] * x + 
    fixef(LHC_mixed_final)[1] +
    fixef(LHC_mixed_final)[5] + 
    fixef(LHC_mixed_final)[11] * mean(Corallivores_mean[Year == 2009]) +
    fixef(LHC_mixed_final)[12] * mean(MAC_mean[Year == 2009])})
eq_2011_grazer <- with(GBR_Sites_Processed_2004, function(x){fixef(LHC_mixed_final)[10] * x + 
    fixef(LHC_mixed_final)[1] +
    fixef(LHC_mixed_final)[6] + 
    fixef(LHC_mixed_final)[11] * mean(Corallivores_mean[Year == 2011]) +
    fixef(LHC_mixed_final)[12] * mean(MAC_mean[Year == 2011])})
eq_2012_grazer <- with(GBR_Sites_Processed_2004, function(x){fixef(LHC_mixed_final)[10] * x + 
    fixef(LHC_mixed_final)[1] +
    fixef(LHC_mixed_final)[7] + 
    fixef(LHC_mixed_final)[11] * mean(Corallivores_mean[Year == 2012]) +
    fixef(LHC_mixed_final)[12] * mean(MAC_mean[Year == 2012])})
eq_2013_grazer <- with(GBR_Sites_Processed_2004, function(x){fixef(LHC_mixed_final)[10] * x + 
    fixef(LHC_mixed_final)[1] +
    fixef(LHC_mixed_final)[8] + 
    fixef(LHC_mixed_final)[11] * mean(Corallivores_mean[Year == 2013]) +
    fixef(LHC_mixed_final)[12] * mean(MAC_mean[Year == 2013])})
eq_2014_grazer <- with(GBR_Sites_Processed_2004, function(x){fixef(LHC_mixed_final)[10] * x + 
    fixef(LHC_mixed_final)[1] +
    fixef(LHC_mixed_final)[9] + 
    fixef(LHC_mixed_final)[11] * mean(Corallivores_mean[Year == 2014]) +
    fixef(LHC_mixed_final)[12] * mean(MAC_mean[Year == 2014])})

#Plot with grazers on the x axis
LHC_grazers_plot <- ggplot(GBR_Sites_Processed_2004) + 
  aes(y = LHC_mean, color = MAC_mean, x = Grazers_mean) +
  geom_point() +
  ylim(0, 100) +
  scale_color_viridis_c(option = "plasma") +
  theme(legend.position = "top") +
  labs(y = "Mean live hard coral % cover", 
       x = "Mean number of grazer fish species",
       color = "Mean fleshy macroalgae % cover") +
  facet_wrap(vars(Year)) +
  stat_function(fun = eq_2004_grazer, 
                data = subset(GBR_Sites_Processed_2004, 
                              Year == 2004)) + 
  stat_function(fun = eq_2006_grazer, 
                data = subset(GBR_Sites_Processed_2004, 
                              Year == 2006)) +
  stat_function(fun = eq_2007_grazer, 
                data = subset(GBR_Sites_Processed_2004, 
                              Year == 2007)) +
  stat_function(fun = eq_2008_grazer, 
                data = subset(GBR_Sites_Processed_2004, 
                              Year == 2008)) +
  stat_function(fun = eq_2009_grazer, 
                data = subset(GBR_Sites_Processed_2004, 
                              Year == 2009)) +
  stat_function(fun = eq_2011_grazer, 
                data = subset(GBR_Sites_Processed_2004, 
                              Year == 2011)) +
  stat_function(fun = eq_2012_grazer, 
                data = subset(GBR_Sites_Processed_2004, 
                              Year == 2012)) +
  stat_function(fun = eq_2013_grazer, 
                data = subset(GBR_Sites_Processed_2004, 
                              Year == 2013)) +
  stat_function(fun = eq_2014_grazer, 
                data = subset(GBR_Sites_Processed_2004, 
                              Year == 2014)) 

print(LHC_grazers_plot)

```

## Question 2: What variables affect fish density on the inshore coral reefs of the GBRMP?

```{r Fish Density Plot, echo = FALSE, fig.align = left, fig.cap = "Modeled relationship between the mean percent cover of living hard coral and the natural log of fish density for 2004, 2006-2009, and 2011-2014."}

Fish_densit_plot <- ggplot(GBR_Sites_Processed_2004_fish_lme) + 
  aes(y = log(Total.Fish.Densit_mean), x = LHC_mean, color = Year) +
  geom_point() +
  geom_line(aes(x = LHC_mean, y = Model)) +
  scale_color_viridis_d(direction = -1) +
  labs(x = "Mean live hard coral % cover", 
       y = expression('Ln mean total fish density (per 1000 m'^"2"*')'),
       color = "")

print(Fish_densit_plot)
```

##Question 3: Do no-take zones established in 1987, no-take zones established in 2004, and fished zones have different mean amounts of live hard coral cover, fish density, and fish species richness?


\newpage

# Summary and Conclusions

• Major findings are summarized
• Conclusions relate back to the original research context

\newpage

# References
<add references here if relevant, otherwise delete this section> 
